# üß≠ Avalonia Navigation Template

> C–∏—Å—Ç–µ–º–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ Avalonia —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏–Ω–∏—Ü–ø—É –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ SOLID.

---

## üìå –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —à–∞–±–ª–æ–Ω –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ Avalonia UI, —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å —É—á—ë—Ç–æ–º —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∞ —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.

–û–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è:
- –ë—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ –Ω–æ–≤—ã—Ö Avalonia-–ø—Ä–æ–µ–∫—Ç–æ–≤.
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.
- –ì–∏–±–∫–æ–π –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.

---

## üõ†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –û–±—ã—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏ (—á–µ—Ä–µ–∑ ViewModel).
- ‚úÖ –û–≤–µ—Ä–ª–µ–π–Ω–∞—è (–≤–ª–æ–∂–µ–Ω–Ω–∞—è) –Ω–∞–≤–∏–≥–∞—Ü–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –∏–ª–∏ –ø–∞–Ω–µ–ª–µ–π.
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞–∑–∞–¥ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π ViewModel (–∏—Å—Ç–æ—Ä–∏—è –≤ —Å—Ç–µ–∫–µ).
- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞–∑–∞–¥ –∏–∑ –æ–≤–µ—Ä–ª–µ—è –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π ViewModel.
- ‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä ViewModel.
- ‚úÖ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ Microsoft.Extensions.DependencyInjection –∏ Splat.
- ‚úÖ –°–æ–±–ª—é–¥–µ–Ω–∏–µ SOLID-–ø—Ä–∏–Ω—Ü–∏–ø–æ–≤:
  - S ‚Äî Single Responsibility Principle: –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (NavStore, NavigationService –∏ —Ç.–¥.) –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É –∑–∞–¥–∞—á—É.
  - D ‚Äî Dependency Inversion Principle: –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–Ω—ä–µ—Ü–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ IoC-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

---

## üßΩ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é MVVMNavigationKit

### üìå 1. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π `ViewModel`

–°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å `ViewModel`, —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã–π –æ—Ç `ViewModelTemplate`, –∏ —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ –µ–≥–æ –º–µ—Ç–æ–¥—ã:

```csharp
public class ViewModelBase : ViewModelTemplate
{
    protected bool IsDisposed { get; set; } = false;

    public override void Dispose()
    {
        if (IsDisposed) return;
        GC.SuppressFinalize(this);
        IsDisposed = true;
    }

    public override void RefreshPage() { }

    protected override void InitializeParams<T>(T @params) { }
}
```


### üóÑÔ∏è 2. –°–æ–∑–¥–∞–Ω–∏–µ `MainWindowViewModel`

`MainWindowViewModel` —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–π `ViewModel`:

```csharp
public partial class MainWindowViewModel : ViewModelBase
{
    public ViewModelTemplate? CurrentViewModel => _navStore.CurrentViewModel;

    private readonly INavigationStore _navStore;

    public MainWindowViewModel(INavigationStore navStore)
    {
        _navStore = navStore;
        _navStore.PropertyChanged += OnViewModelChanged;
    }

    private void OnViewModelChanged(object? sender, PropertyChangedEventArgs e)
    {
        if (e.PropertyName == nameof(_navStore.CurrentViewModel))
            OnPropertyChanged(nameof(CurrentViewModel));
    }

    public override void Dispose()
    {
        if (IsDisposed) return;
        _navStore.PropertyChanged -= OnViewModelChanged;
        CurrentViewModel?.Dispose();
        base.Dispose();
    }
}
```

#### üìå –ü—Ä–∏–≤—è–∑–∫–∞ –≤ XAML

```xml
<ContentControl Content="{Binding CurrentViewModel}" />
```

### üß∞ 3. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (DI)

#### ‚úÖ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:

```csharp
private void ConfigureNavigationServices(IServiceCollection services)
{
    NavigationServicesHelper.CreateServiceCollections(services);
}
```

#### ‚öôÔ∏è –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:

```csharp
services.AddLogging(config => {
    config.SetMinimumLevel(LogLevel.Information);
});

services.AddSingleton<INavigationStore, NavigationStore>();
services.Configure<NavigationOptions>(opt => { });
services.AddSingleton<INavigationService, NavigationService>();
```

### ü™ü 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `MainWindow` –∏ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

#### üßπ –ü—Ä–∏–≤—è–∑–∫–∞ `ViewModel` –∫ `MainWindow`:

```csharp
if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
{
    desktop.MainWindow = new MainWindow();
    desktop.MainWindow.DataContext = ServiceProvider.GetRequiredService<MainWindowViewModel>();
}
```

#### üåü –°—Ç–∞—Ä—Ç–æ–≤–∞—è `ViewModel`:

```csharp
public class StartPageViewModel : ViewModelBase
{
    private readonly INavigationService _navService;

    public StartPageViewModel(INavigationService navService)
    {
        _navService = navService;
    }
}
```

#### üì¶ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è `View` –∏ `ViewModel` –≤ `MainWindow.xaml`:

```xml
<Window.DataTemplates>
    <DataTemplate DataType="vm:StartPageViewModel">
        <view:StartPage />
    </DataTemplate>
</Window.DataTemplates>
```

#### üßΩ –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:

```csharp
INavigationService navigationService = ServiceProvider.GetRequiredService<INavigationService>();
navigationService.Navigate<StartPageViewModel>();
```

### ‚ûï 5. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö `ViewModel`

#### üîπ –ü—Ä–∏–º–µ—Ä –Ω–æ–≤–æ–π `ViewModel`:

```csharp
public class MainPageViewModel : ViewModelBase
{
    private readonly INavigationService _navService;

    public MainPageViewModel(INavigationService navService)
    {
        _navService = navService;
    }
}
```

#### üîπ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ DI:

```csharp
services.AddTransient<MainPageViewModel>();
```

#### üîπ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ `DataTemplates`:

```xml
<Window.DataTemplates>
    <DataTemplate DataType="vm:StartPageViewModel">
        <view:StartPage />
    </DataTemplate>
    <DataTemplate DataType="vm:MainPageViewModel">
        <view:MainPage />
    </DataTemplate>
</Window.DataTemplates>
```

#### üîπ –ü–µ—Ä–µ—Ö–æ–¥ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏:

```csharp
public void NavToMain() => _navService.DestroyAndNavigate<MainPageViewModel>();
```

---


## üîß –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Avalonia UI (https://avaloniaui.net/) ‚Äî –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π UI-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫.
- Microsoft.Extensions.DependencyInjection (https://learn.microsoft.com/en-us/dotnet/core/extensions/dependency-injection) ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä .NET.
- Splat.Microsoft.Extensions.DependencyInjection (https://github.com/reactiveui/splat) ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Splat —Å Microsoft DI.
- CommunityToolkit.Mvvm (https://learn.microsoft.com/en-us/dotnet/communitytoolkit/mvvm/) ‚Äî –ª—ë–≥–∫–∞—è –∏ –º–æ—â–Ω–∞—è MVVM-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞.
