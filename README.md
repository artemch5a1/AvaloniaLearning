# üß≠ Avalonia Navigation Template

> C–∏—Å—Ç–µ–º–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ Avalonia —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏ —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏–Ω–∏—Ü–ø—É –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ SOLID.

---

## üìå –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —à–∞–±–ª–æ–Ω –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ Avalonia UI, —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å —É—á—ë—Ç–æ–º —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∞ —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.

–û–Ω –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è:
- –ë—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ –Ω–æ–≤—ã—Ö Avalonia-–ø—Ä–æ–µ–∫—Ç–æ–≤.
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.
- –ì–∏–±–∫–æ–π –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.

---

## üõ†Ô∏è –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –û–±—ã—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏ (—á–µ—Ä–µ–∑ ViewModel).
- ‚úÖ –û–≤–µ—Ä–ª–µ–π–Ω–∞—è (–≤–ª–æ–∂–µ–Ω–Ω–∞—è) –Ω–∞–≤–∏–≥–∞—Ü–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –∏–ª–∏ –ø–∞–Ω–µ–ª–µ–π.
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞–∑–∞–¥ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π ViewModel (–∏—Å—Ç–æ—Ä–∏—è –≤ —Å—Ç–µ–∫–µ).
- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞–∑–∞–¥ –∏–∑ –æ–≤–µ—Ä–ª–µ—è –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π ViewModel.
- ‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä ViewModel.
- ‚úÖ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ Microsoft.Extensions.DependencyInjection –∏ Splat.
- ‚úÖ –°–æ–±–ª—é–¥–µ–Ω–∏–µ SOLID-–ø—Ä–∏–Ω—Ü–∏–ø–æ–≤:
  - S ‚Äî Single Responsibility Principle: –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (NavStore, NavigationService –∏ —Ç.–¥.) –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É –∑–∞–¥–∞—á—É.
  - D ‚Äî Dependency Inversion Principle: –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–Ω—ä–µ—Ü–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ IoC-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

---

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π ViewModel

- –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å –∏ –Ω–∞—Å–ª–µ–¥—É–π—Ç–µ –µ–≥–æ –æ—Ç ViewModelTemplate
- –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã

–ü—Ä–∏–º–µ—Ä:
```csharp
  public class ViewModelBase : ViewModelTemplate
{
    protected bool IsDisposed { get; set; } = false;

    public override void Dispose()
    {
        if (IsDisposed)
            return;
        GC.SuppressFinalize(this);
        IsDisposed = true;
    }

    public override void RefreshPage() { }

    protected override void InitializeParams<T>(T @params) { }
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ MainWindowViewModel

–†–µ–∞–ª–∏–∑—É–π—Ç–µ ViewModel –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞:
- –ü–µ—Ä–µ–¥–∞–π—Ç–µ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä INavigationStore
- –°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –±—Ä–∞—Ç—å –∏–∑ INavigationStore —Ç–µ–∫—É—â—É—é ViewModel
- –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ INavigationStore, —á—Ç–æ–±—ã —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—é

```csharp

public partial class MainWindowViewModel : ViewModelBase
{
    public ViewModelTemplate? CurrentViewModel => _navStore.CurrentViewModel;

    private readonly INavigationStore _navStore;

    public MainWindowViewModel(INavigationStore navStore)
    {
        _navStore = navStore;
        _navStore.PropertyChanged += OnViewModelChanged;
    }

    private void OnViewModelChanged(object? sender, PropertyChangedEventArgs e)
    {
        if (e.PropertyName == nameof(_navStore.CurrentViewModel))
        {
            OnPropertyChanged(nameof(CurrentViewModel));
        }
    }

    public override void Dispose()
    {
        if (IsDisposed)
            return;
        _navStore.PropertyChanged -= OnViewModelChanged;
        CurrentViewModel?.Dispose();
        base.Dispose();
    }
}

```

–ù–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ –ø—Ä–∏–≤—è–∂–∏—Ç–µ CurrentViewModel –≤ ContentControl

```xaml
<ContentControl Content="{Binding CurrentViewModel}"/>

```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ DI

–ß—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—è —Å–µ—Ä–≤–∏—Å–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
- –°–æ–∑–¥–∞—Ç—å DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- –°–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–º–∏—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–ú–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≥–æ—Ç–æ–≤—ã–º –º–µ—Ç–æ–¥–æ–º –∏–∑ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–º–µ–Ω MVVMNavigationKit.ServiceBuild

```csharp
private void ConfigureNavigationServices(IServiceCollection services)
{
    NavigationServicesHelper.CreateServiceCollections(services);
}
```

–ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ —Ä—É—á–Ω—É—é –¥–ª—è –±–æ–ª–µ–µ —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

```csharp
services.AddLogging(config =>
{
    config.SetMinimumLevel(LogLevel.Information);
});

services.AddSingleton<INavigationStore, NavigationStore>();

services.Configure<NavigationOptions>(opt => { });

services.AddSingleton<INavigationService, NavigationService>();
```

–î–∞–ª–µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å MainWindow –∏ —Å—Ç–∞—Ä—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

- –ü–æ–ª—É—á–∏—Ç–µ –∏–∑ —Å–µ—Ä–≤–∏—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ MainWindowViewModel –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ DataContext MainWindow:

```csharp
desktop.MainWindow = new MainWindow();
desktop.MainWindow.DataContext =
    ServiceProvider.GetRequiredService<MainWindowViewModel>();
```

- –°–æ–∑–¥–∞–π—Ç–µ —Å—Ç–∞—Ä—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:

ViewModel
```csharp
public class StartPageViewModel : ViewModelBase
{
    private readonly INavigationService _navService;

    public StartPageViewModel(INavigationService navService)
    {
        _navService = navService;
    }
}
```

- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ MainWindow —Å–æ–æ—Ç–≤–µ—Å—Ç–≤–∏–µ <View, ViewModel>

```xaml
<Window.DataTemplates>
	<DataTemplate DataType="vm:StartPageViewModel">
		<view:StartPage/>
	</DataTemplate>
</Window.DataTemplates>
```

- –ù–∞–≤–∏–≥–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –Ω–µ–µ –≤ App.axaml.cs

```csharp
if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)
{
    desktop.MainWindow = new MainWindow();
    desktop.MainWindow.DataContext =
        ServiceProvider.GetRequiredService<MainWindowViewModel>();
}

INavigationService navigationService =
    ServiceProvider.GetRequiredService<INavigationService>();

navigationService.Navigate<StartPageViewModel>();
```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ViewModel –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è

–ü—Ä–µ–∂–¥–µ —á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –¥–ª—è –Ω–æ–≤–æ–π —Å–≤—è–∑–∫–∏ <View, ViewModel>:
- –£–Ω–∞—Å–ª–µ–¥—É–π—Ç–µ –≤–∞—à ViewModel –æ—Ç ViewModelBase

```csharp
public partial class MainPageViewModel : ViewModelBase
{
    private readonly INavigationService _navService;

    public MainPageViewModel(INavigationService navService)
    {
        _navService = navService;
    }
}
```

- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ DI

```csharp
services.AddTransient<MainPageViewModel>();
```

- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Å—Ç–≤–∏–µ view –∏ viewmodel –≤ MainWindow

```csharp
<Window.DataTemplates>
	<DataTemplate DataType="vm:StartPageViewModel">
		<view:StartPage/>
	</DataTemplate>
	<DataTemplate DataType="vm:MainPageViewModel">
		<view:MainPage/>
	</DataTemplate>
</Window.DataTemplates>
```

- –ù–∞–≤–∏–≥–∏—Ä—É–π—Ç–µ—Å—å –æ–¥–Ω–∏–º –∏–∑ –Ω—É–∂–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤

```csharp
public void NavToMain() => _navService.DestroyAndNavigate<MainPageViewModel>();
```

---

## üîß –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Avalonia UI (https://avaloniaui.net/) ‚Äî –∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π UI-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫.
- Microsoft.Extensions.DependencyInjection (https://learn.microsoft.com/en-us/dotnet/core/extensions/dependency-injection) ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä .NET.
- Splat.Microsoft.Extensions.DependencyInjection (https://github.com/reactiveui/splat) ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Splat —Å Microsoft DI.
- CommunityToolkit.Mvvm (https://learn.microsoft.com/en-us/dotnet/communitytoolkit/mvvm/) ‚Äî –ª—ë–≥–∫–∞—è –∏ –º–æ—â–Ω–∞—è MVVM-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞.

<details>
  <summary>üìÅ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞</summary>

  <pre>
AvaloniaLearning
‚îú‚îÄ‚îÄ Dependencies
‚îÇ   ‚îú‚îÄ‚îÄ NavigationStore
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NavStore.cs
‚îÇ   ‚îî‚îÄ‚îÄ NavService
‚îÇ       ‚îî‚îÄ‚îÄ NavigationService.cs
|       ‚îî‚îÄ‚îÄ INavigationService.cs
‚îú‚îÄ‚îÄ View
‚îÇ   ‚îú‚îÄ‚îÄ Base
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MainWindow.axaml
‚îÇ   ‚îî‚îÄ‚îÄ Pages
‚îÇ       ‚îú‚îÄ‚îÄ MainPage.axaml
‚îÇ       ‚îî‚îÄ‚îÄ StartPage.axaml
‚îú‚îÄ‚îÄ ViewModel
‚îÇ   ‚îú‚îÄ‚îÄ ViewModelBase
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MainWindowViewModel.cs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ViewModelBase.cs
‚îÇ   ‚îú‚îÄ‚îÄ MainPageViewModel.cs
‚îÇ   ‚îî‚îÄ‚îÄ StartPageViewModel.cs

  </pre>
</details>
